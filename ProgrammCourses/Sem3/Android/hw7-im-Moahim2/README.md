# Теперь мессенжер

## Что надо

Реализовать двухпанельный дизайн

![Слева чаты, справа диалоги (на планшете), на телефоне — две разные Activity](https://learn.microsoft.com/ru-ru/xamarin/android/platform/fragments/images/00.png)

Более формально:
- Вёрстка
  - Горизонтальная ориентация
    - Слева список диалогов
    - Справа чат
      - Картинка в хорошем разрешении может открываться как в отдельной Activity, 
        так и в окне чата
  - Портретная ориентация
    - Список диалогов, по клику открывается чат
      - Можно открыть новую Activity, можно заменить фрагмент
    - Кнопка "назад" из чата возвращает к списку
- Список чатов должен быть фрагментом
- Чат должен быть фрагментом
- Вышеупомянутые фрагменты должны быть общими для обоих ориентаций
- _Не_ использовать реализацию фрагментов из `android.app.Fragment`
  - Используйте [версию из androidx](https://developer.android.com/reference/androidx/fragment/app/Fragment)

### Где взять чаты?

Хост всё так же лежит по адресу http://213.189.221.170:8008

API сервера стало несколько шире

- GET `/1ch` <br/>
  Список сообщений из канала `1@channel`, то же самое, что и `/channel/1@channel`
- GET `/channel/<имя канала>` <br/>
  Список сообщений из указанного канала
- GET `/inbox/<имя пользователя>` <br/>
  Список входящих и исходящих сообщений конкретного пользователя
  - `limit` <br/>
    Сколько сообщений отдавать, по умолчанию 20
  - `lastKnownId` <br/>
    Начиная с какого сообщения отдавать сообщения, по умолчанию 0
  - `reverse` <br/>
    Возвращает сообщения в обратном порядке (с `id` _меньше_, чем `lastKnownId`), по умолчанию `false`
- GET `/channels` </br>
  Список каналов в виде JSON массива строк
- GET `/img/<path>` <br/>
  Картиночка по указанному пути в хорошем разрешении
- GET `/thumb/<path>` <br/>
  Картиночка по указанному пути в шакальном разрешении
- POST `/1ch` (или `/messages`) с сообщением в body и `Content-Type=application/json`
    - `200 OK` и `id` поста
    - Ошибку, смотри коды состояния HTTP
- POST `/1ch` (или `/messages`) с сообщением в body и `Content-Type=multipart/form-data`
    - `200 OK` и `id` поста
    - Ошибку, смотри коды состояния HTTP
    - Сообщение идёт с названием `msg`
    - Картинка идёт с названием `picture`
    - Используйте `@Multipart` из Retrofit

Сообщение не изменилось

```json lines
{
  "id": "123", // optional for request
  "from": "my name", // mandatory
  "to": "1@ch", // optional for request, defaults to "1@channel"
  "data": {
    "Text": {
      "text": "my message" // mandatory
    },
    // OR (moreover, XOR)
    "Image": {
      "link": "path/to/pic.jpg" // optional for request
    }
  },
  "time": "1297490" // UNIX-time, optional for requests
}
```

Как создать новый канал? Напишите в него сообщение. Все каналы имеют суффикс `@channel`.

## Критерии провала

- Отдельная реализация под разную ориентацию
  - Списка чатов
  - Чата
- Реализация этого механизма без фрагментов
- Падение
- Заблокированный поворот экрана

## Бонусы

- +0,5 за анимации прехода
- +0,5 за кнопку "назад" в тулбаре, которая ведёт себя как системная
